(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1377:function(e,t,n){var content=n(1495);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(35).default)("a1ff9424",content,!0,{sourceMap:!1})},1408:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return d}));var r=n(631),o=n.n(r);console.log("env",void 0);var l=function(t,n){var r=e.from("65a2b862088509b122407245706fb715","hex"),l=e.from(n,"hex"),c=o.a.createDecipheriv("aes256",l,r);return c.update(t,"hex","hex")+c.final("hex")},c=function(t,n){var r=o.a.createCipheriv("aes256",e.from(t,"hex"),e.from("65a2b862088509b122407245706fb715","hex"));return r.update(n,"utf-8","hex")+r.final("hex")},d=function(t,n){var r=o.a.createDecipheriv("aes256",e.from(e.from(t,"hex")),e.from("65a2b862088509b122407245706fb715","hex"));return r.update(n,"hex","utf-8")+r.final("utf-8")}}).call(this,n(52).Buffer)},1494:function(e,t,n){"use strict";n(1377)},1495:function(e,t,n){var r=n(34)(!1);r.push([e.i,".xo-channel-chat-history[data-v-7c238e64]{padding:30px 30px 0;min-height:100%}@media screen and (max-width:767px){.xo-channel-chat-history[data-v-7c238e64]{padding:30px 30px 0 10px}}.xo-channel-chat-history[data-v-7c238e64] .infinite-loading-container{margin-bottom:20px}",""]),e.exports=r},1616:function(e,t,n){"use strict";n.r(t);n(17),n(16),n(19),n(13),n(20);var r=n(93),o=n(0),l=n(5),c=(n(27),n(8),n(28),n(31),n(14),n(79),n(124),n(386),n(67),n(11)),d=n(36),h=n(1408);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function v(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var y={name:"XOChannelsChatHistory",components:{XMChannelsChatItem:function(){return Promise.all([n.e(3),n.e(0),n.e(19),n.e(96)]).then(n.bind(null,2585))},XAChannelsChatLoader:function(){return n.e(29).then(n.bind(null,2667))},XAChannelsTyping:function(){return n.e(30).then(n.bind(null,2668))}},props:{cursored:{type:Boolean,required:!1,default:!0},channel:{type:Object,required:!1,default:function(){}},isEncrypted:{type:Boolean,required:!1,default:!1},chats:{type:Array,default:function(){return[]}},showInfiniteLoading:{type:Boolean,default:!1},usersTyping:{type:Array,default:function(){return[]}}},data:function(){return{cursor:10,addedChats:[],localChats:this.chats||[]}},computed:v(v(v(v({},Object(c.b)("messages",["messageNext"])),Object(c.b)("user",["userID","encryptionKey"])),Object(d.c)({getChatDeletedForEveryone:"chats/getChatDeletedForEveryone",getChatDeletedForSelf:"chats/getChatDeletedForSelf"})),{},{filteredLocalChats:function(){var e=this;return this.localChats.filter((function(t){return!(null!=t&&t.isDeletedEveryone||e.getChatDeletedForEveryone.includes(null==t?void 0:t.chatID))})).filter((function(t){var n;return(null==t||null===(n=t.User)||void 0===n?void 0:n.id)===e.userID?!(null!=t&&t.isDeletedSelf||e.getChatDeletedForSelf.includes(null==t?void 0:t.chatID)):t}))},filteredAddedChats:function(){var e=this;return this.addedChats.filter((function(t){return!(null!=t&&t.isDeletedEveryone||e.getChatDeletedForEveryone.includes(null==t?void 0:t.chatID))})).filter((function(t){var n;return(null==t||null===(n=t.User)||void 0===n?void 0:n.id)===e.userID?!(null!=t&&t.isDeletedSelf||e.getChatDeletedForSelf.includes(null==t?void 0:t.chatID)):t}))}}),mounted:function(){var e=this;this.$root.$on("evtRtUpdateChatList",(function(t){var n=e.localChats.findIndex((function(e){return(null==e?void 0:e.chatID)===(null==t?void 0:t.chatID)})),r=e.addedChats.findIndex((function(e){return(null==e?void 0:e.chatID)===(null==t?void 0:t.chatID)}));e.localChats[n]&&(e.localChats[n].text=null==t?void 0:t.text,e.localChats[n].isEdited=null==t?void 0:t.isEdited),e.addedChats[r]&&(e.addedChats[r].text=null==t?void 0:t.text,e.addedChats[r].isEdited=null==t?void 0:t.isEdited)}))},methods:{fnRetrieveNextChats:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,l,c,d,f,v,y,x,C;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o={channelSlug:t.$route.params.channel,count:10,cursor:t.cursored?t.cursor:0},n.next=4,t.$api.getMessagesByChannelSlug(o);case 4:if(l=n.sent,c=l.getMessagesByChannelSlug,d=c.items,f=c.next,t.cursor=f,v=t.isEncrypted&&Object(h.a)(t.channel.EncryptionKey,t.encryptionKey),!d.length){n.next=15;break}return y=d.map((function(e){var n;t.isEncrypted&&(e.text&&(e.text=Object(h.b)(v,e.text)),null!==(n=e.RepliedTo)&&void 0!==n&&n.text&&(e.RepliedTo.text=Object(h.b)(v,e.RepliedTo.text)));return e})),t.filteredLocalChats.length?(x=t.addedChats).unshift.apply(x,Object(r.a)(y)):(C=t.localChats).unshift.apply(C,Object(r.a)(y)),null==e||e.loaded(),n.abrupt("return");case 15:null==e||e.complete(),n.next=21;break;case 18:n.prev=18,n.t0=n.catch(0),t.$toast.error(n.t0.message,{duration:5e3,position:"bottom-left",className:"fx1-error",iconPack:"mdi",icon:"alert-circle-outline"});case 21:case"end":return n.stop()}}),n,null,[[0,18]])})))()}}},x=(n(1494),n(10)),component=Object(x.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"xo-channel-chat-history flex-column",on:{contextmenu:function(e){e.preventDefault()}}},[e.chats.length>=10&&e.showInfiniteLoading||!e.filteredLocalChats.length?n("infinite-loading",{attrs:{direction:"top",distance:300},on:{infinite:e.fnRetrieveNextChats}},[n("div",{attrs:{slot:"spinner"},slot:"spinner"},[n("XAChannelsChatLoader")],1),n("div",{attrs:{slot:"no-more"},slot:"no-more"}),n("div",{attrs:{slot:"no-results"},slot:"no-results"})]):e._e(),e._l(e.filteredAddedChats,(function(e,t){return n("XMChannelsChatItem",{key:t+"-added-chat",attrs:{chat:e,"scroll-to-bottom":!1}})})),e._l(e.filteredLocalChats,(function(t,r){return n("XMChannelsChatItem",{key:r+"-chat",attrs:{chat:t,"is-last":r===e.filteredLocalChats.length-1}})})),n("XAChannelsTyping",{attrs:{"users-typing":e.usersTyping}})],2)}),[],!1,null,"7c238e64",null);t.default=component.exports}}]);