(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1283:function(e,t,n){var r=n(1284),o=n(1287)(r);e.exports=o},1284:function(e,t,n){var r=n(1285),o=n(288);e.exports=function(object,e){return object&&r(object,e,o)}},1285:function(e,t,n){var r=n(1286)();e.exports=r},1286:function(e,t){e.exports=function(e){return function(object,t,n){for(var r=-1,o=Object(object),c=n(object),l=c.length;l--;){var h=c[e?l:++r];if(!1===t(o[h],h,o))break}return object}}},1287:function(e,t,n){var r=n(379);e.exports=function(e,t){return function(n,o){if(null==n)return n;if(!r(n))return e(n,o);for(var c=n.length,l=t?c:-1,h=Object(n);(t?l--:++l<c)&&!1!==o(h[l],l,h););return n}}},1295:function(e,t,n){var r=n(1283),o=n(379);e.exports=function(e,t){var n=-1,c=o(e)?Array(e.length):[];return r(e,(function(e,r,o){c[++n]=t(e,r,o)})),c}},1506:function(e,t,n){var r=n(612),o=n(384),c=n(1295),l=n(114);e.exports=function(e,t){return(l(e)?r:c)(e,o(t,3))}},2060:function(e,t,n){var content=n(2536);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(35).default)("cc9f4f48",content,!0,{sourceMap:!1})},2535:function(e,t,n){"use strict";n(2060)},2536:function(e,t,n){var r=n(34)(!1);r.push([e.i,".xp-locker-room-channels[data-v-79267fee]{height:100%}.show .unsupported[data-v-79267fee]{width:100%;display:flex;flex-direction:column;padding:12px 16px;position:absolute;bottom:0}.show .unsupported .unsupported-btn[data-v-79267fee]{display:flex;align-items:center;justify-content:center;height:40px;background:#f85454;color:#fff;cursor:pointer;border-radius:5px;margin-bottom:16px}.show .unsupported span[data-v-79267fee]{font-style:normal;font-weight:400;font-size:13px;color:#c3cdcf}",""]),e.exports=r},2698:function(e,t,n){"use strict";n.r(t);n(17),n(16),n(19),n(13),n(20);var r=n(93),o=n(29),c=n(0),l=n(5),h=(n(27),n(8),n(28),n(31),n(383),n(229),n(67),n(14),n(154),n(24),n(1072)),d=n(11),f=n(36),map=n(1506),v=n.n(map),m=n(630),k=n.n(m),C=n(1379);function R(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?R(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):R(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var x={name:"PageLockerRoomChannels",components:{XTLockerRoomSupported:function(){return Promise.all([n.e(0),n.e(8),n.e(9),n.e(92)]).then(n.bind(null,2709))}},layout:"locker-room",props:{channelSlug:{type:String,default:""},game:{type:Object,default:function(){}},privateChannel:{type:Object,default:function(){}},activeChat:{type:String,required:!0},currentStep:{type:Number,default:1},lockerRoomProp:{type:Object,default:function(){}}},data:function(){return{socket:null,pageLoaded:!1,myEmitErrors:{},channel:null,oldChannel:null,isSupported:!0,lockerRoom:null,chats:[],privateChats:[],usersTyping:[],onlineMembers:[],publicMembers:[]}},computed:S(S(S(S(S(S(S({},Object(d.b)("locker-room",["lockerRoomActive","lockerRoomReply"])),Object(d.b)("user",["userID","userName","userAvatar"])),Object(d.b)("channels",["channelActive"])),Object(d.b)("app",["showLoader"])),Object(d.b)("chats",["unread","mode"])),Object(f.c)({getMediaFilesLocal:"media/getMediaFilesLocal",getLockerRoomIsLoading:"lockerRoom/getLockerRoomIsLoading",selectedGif:"giphy/getSelectedGif"})),{},{activeChannelSlug:function(){var e;return"public"===this.activeChat?this.channelSlug:null===(e=this.privateChannel)||void 0===e?void 0:e.slug}}),watch:{selectedGif:function(){this.selectedGif&&this.userID&&(this.fnSendMessage(null,this.lockerRoomReply),this.$store.dispatch("locker-room/setLockerRoomReply",null))},lockerRoomActive:{deep:!0,handler:function(e){this.isSupported=this.isSupported||(null==e?void 0:e.isSupported)}},activeChat:{deep:!0,handler:function(){this.fnConnectToChannel()}},$route:{deep:!0,immediate:!0,handler:function(){this.$root.$emit("evtRtCancelEdit"),this.clearChatDeleted()}}},mounted:function(){var e=this;this.socket=this.$nuxtSocket({channel:"/",auth:{token:this.$store.state.auth.token||null,type:"desktop"},transports:["websocket"]}),this.$root.$on("evtRtSendMessage",(function(t,n,r,o){e.fnSendMessage(t,n,r,o),e.unread=!1})),this.$root.$on("evtRtEditMessage",(function(data){e.fnEditMessage(data)})),this.$root.$on("evtRtDeleteMessage",(function(data){e.fnDeleteMessage(data)})),this.$root.$on("leavePrtChat",(function(data){e.fnLeavePrivateChat(data)})),this.socket.on("on-message",(function(data){var t,n=data.chat;n.channelSlug===e.channelSlug?e.chats.push(data.chat):n.channelSlug===(null===(t=e.privateChannel)||void 0===t?void 0:t.slug)&&(e.privateChats.push(data.chat),"video"===e.mode&&(e.unread=!0))})),this.socket.on("on-edit-message",(function(data){data.chat&&(v()(e.chats,(function(e){e.chatID===data.chat.chatID&&(e.text=data.chat.text,e.isEdited=!0)})),v()(e.privateChats,(function(e){e.chatID===data.chat.chatID&&(e.text=data.chat.text,e.isEdited=!0)})))})),this.socket.on("on-delete-message",(function(data){var t;if(data.chat){var n=k()(e.chats,{chatID:data.chat.chatID}),r=k()(e.privateChats,{chatID:data.chat.chatID});null!=data&&null!==(t=data.chat)&&void 0!==t&&t.isDeletedEveryone&&(-1!==n?e.chats.splice(n,1):-1!==r&&e.privateChats.splice(r,1),e.fnDeleteReply({chatID:data.chat.chatID,deleteForSelf:!1,deleteForEveryone:!0,chats:1!==r?e.privateChats:e.chats}))}})),this.socket.on("on-typing-message-v2",(function(data){e.usersTyping=data.filter((function(t){var n=t.username,r=t.channelSlug;return n&&r===e.activeChannelSlug})).map((function(e){return e.username}))})),this.socket.on("logs",(function(data){"on-channel-user-online"===data.call&&(e.publicMembers=data.payload.onlineUsers),console.log("SERVERLOGS",data)})),this.socket.on("status-online",(function(data){e.onlineMembers=data})),this.clearLockerRoomDeletedManagers(),this.$root.$on("evtRtGetChannel",(function(){e.fnGetChannel()})),this.channelActive=this.channel,this.$root.$on("evtRtIsTyping",(function(t){e.fnTypingMessage({userName:t.userName,status:!0})})),this.$root.$on("evtRtDoneTyping",(function(t){e.fnTypingMessage({userName:t.userName,status:!1})})),this.fnRetrievePageDetails(),this.fnRetrieveIsSupported();var t=this;setInterval((function(){t.socket.emit("ping")}),1e3)},beforeDestroy:function(){this.oldChannel&&this.$root.$emit("evtReloadLockerRoom",this.oldChannel),this.$root.$off("evtRtSendMessage")},methods:S(S({},Object(f.b)({clearLockerRoomDeletedManagers:"locker-room/clearLockerRoomDeletedManagers",clearChatDeleted:"chats/clearChatDeleted",setLockerRoomIsLoading:"lockerRoom/setLockerRoomIsLoading",clearSelectedGift:"giphy/clearSelectedGif"})),{},{fnSendMessage:function(e,t,n,r){var o=this;return Object(c.a)(regeneratorRuntime.mark((function c(){var l,d,input;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,Object(C.b)(),l={User:{username:o.userName||"FX1 User",Avatar:o.userAvatar,id:o.userID},chatID:Object(h.a)(),text:e,channelSlug:o.activeChannelSlug,lockerRoomSlug:o.$route.params.slug,repliedTo:t?{User:{username:null==t?void 0:t.name,id:null==t?void 0:t.userID},text:null==t?void 0:t.text,gif:null==t?void 0:t.gif,chatID:null==t?void 0:t.chatID,Media:null==t?void 0:t.Media}:null,Media:null!=n&&n.length?n:null,MentionedUserIDs:r,gif:o.selectedGif},c.next=5,o.socket.emit("send-message",l,(function(){}));case 5:return l.localMedia=o.getMediaFilesLocal||null,l.replyLocalMedia=(null==t?void 0:t.localMedia)||null,"public"===o.activeChat?o.chats.push(l):"private"===o.activeChat&&o.privateChats.push(l),d=o.lockerRoom||o.lockerRoomProp,o.channelActive=d.ChannelGroups[0].Channels[0],o.$mixpanelClient.eventRoomtrackSendMessage({LockerRoom:d,game:o.game,reply:t}),o.$nextTick((function(){o.$root.$emit("evtRtScrollToBottom")})),c.next=14,o.clearSelectedGift();case 14:c.next=18;break;case 16:c.prev=16,c.t0=c.catch(0);case 18:return c.prev=18,null==(input=document.querySelector(".chat-input"))||input.focus(),c.finish(18);case 22:case"end":return c.stop()}}),c,null,[[0,16,18,22]])})))()},fnEditMessage:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var r,text,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.chatID,text=e.text,o=e.repliedToChatID,c=e.Media,n.next=3,t.socket.emit("edit-message",{channelSlug:t.activeChannelSlug,chatID:r,text:text,repliedToChatID:o,Media:c},(function(){}));case 3:case"end":return n.stop()}}),n)})))()},fnDeleteMessage:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var r,o,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.chatID,o=e.deleteForSelf,c=e.deleteForEveryone,l="public"===t.activeChat?t.chats:t.privateChats,n.next=4,t.socket.emit("delete-message",{channelSlug:t.activeChannelSlug,chatID:r,isDeletedSelf:o,isDeletedEveryone:c},(function(){t.fnDeleteReply({chatID:r,deleteForSelf:o,deleteForEveryone:c,activeChat:l})}));case 4:case"end":return n.stop()}}),n)})))()},fnConnectToChannel:function(e){var t,n=this;this.oldChannel=this.$route.params.channel||null,this.oldChannel&&this.$root.$emit("evtReloadLockerRoom",this.oldChannel),this.$store.dispatch("locker-room/setLockerRoomConnectingToChannel",!0),this.socket.emit("join-channel",{channelSlug:"public"===this.activeChat?this.channelSlug:e||(null===(t=this.privateChannel)||void 0===t?void 0:t.slug)},(function(){var e={lockerRoom:n.lockerRoomActive,channel:n.activeChannelSlug,pageName:"Event room channel",isLoggedIn:n.isLoggedIn};n.$mixpanelClient.trackViewPage(e),n.$store.dispatch("notification/clearActiveChannelNotification",n.$route.params.channel),n.reloadUnreadChats()})),this.$store.dispatch("locker-room/setLockerRoomConnectingToChannel",!1)},fnGetChannel:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.channelSlug,t.next=3,e.$api.getChannel({slug:n});case 3:r=t.sent,o=r.getChannel,e.channel=o;case 6:case"end":return t.stop()}}),t)})))()},fnGetPrivateChannel:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var r,o,c,l,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e,!(c=null===(r=t.privateChannel)||void 0===r?void 0:r.slug)){n.next=8;break}return n.next=5,t.$api.getChannel({slug:c});case 5:n.t0=n.sent,n.next=16;break;case 8:if(!o){n.next=14;break}return n.next=11,t.$api.getChannel({id:o});case 11:n.t1=n.sent,n.next=15;break;case 14:n.t1=null;case 15:n.t0=n.t1;case 16:return l=n.t0,h=l.getChannel,t.$emit("setPrivateChannel",h),n.next=21,t.$store.dispatch("locker-room/setLockerRoomPrivateChat",h);case 21:o&&h&&t.fnConnectToChannel(null==h?void 0:h.slug);case 22:case"end":return n.stop()}}),n)})))()},fnRetrievePageDetails:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,c,l,h,d,f,v,m,k,C,R,S,x,y,$,D,L,M;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h=null===(n=e.$route)||void 0===n||null===(c=n.params)||void 0===c?void 0:c.slug,d=e.channelSlug,f=null===(l=e.privateChannel)||void 0===l?void 0:l.slug,v={channelSlug:e.channelSlug},m={channelSlug:f},t.next=7,Promise.all([e.$api.getMessagesByChannelSlug(v),e.$api.getChannel({slug:d}),e.$api.getLockerRoom({slug:h})]);case 7:if(k=t.sent,C=Object(o.a)(k,3),R=C[0].getMessagesByChannelSlug.items,S=C[1].getChannel,x=C[2].getLockerRoom,!f){t.next=23;break}return t.next=15,Promise.all([e.$api.getMessagesByChannelSlug(m),e.$api.getChannel({slug:f})]);case 15:return y=t.sent,$=Object(o.a)(y,2),D=$[0].getMessagesByChannelSlug,L=$[1].getChannel,e.privateChats=D.items,e.$emit("setPrivateChannel",L),t.next=23,e.$store.dispatch("locker-room/setLockerRoomPrivateChat",L);case 23:return(M=[]).push.apply(M,Object(r.a)(R)),e.isSupported=null==x?void 0:x.isSupported,e.channel=S,e.lockerRoom=x,e.chats=M,e.pageLoaded=!0,t.next=32,e.$store.dispatch("locker-room/setLockerRoomActive",e.lockerRoom);case 32:e.lockerRoomReply=null;case 33:case"end":return t.stop()}}),t)})))()},fnDeleteReply:function(e){var t=e.chatID,n=e.deleteForEveryone,r=e.deleteForSelf,o=e.chats;v()(o,(function(data){var e;(null===(e=data.repliedTo)||void 0===e?void 0:e.chatID)===t&&(data.repliedTo=S(S({},{isDeletedEveryone:n,isDeletedSelf:r}),data.repliedTo))}))},fnTypingMessage:function(e){var t=e.userName,n=e.status;this.socket.emit("typing-message-v2",{channelSlug:this.activeChannelSlug,userName:t,isTyping:n})},reloadUnreadChats:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$api.getMyProfileSupporting();case 4:if(n=t.sent,r=n.Me.Supporting){t.next=8;break}return t.abrupt("return");case 8:return o=[],t.next=11,null==r?void 0:r.map((function(data){return o.push({slug:data.slug,totalUnreadMessagesCount:data.totalUnreadMessagesCount})}));case 11:return t.next=13,e.$store.dispatch("notification/setLockerRoomCount",o);case 13:case"end":return t.stop()}}),t)})))()},fnRetrieveIsSupported:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.getLockerRoomIsSupported({slug:null===(n=e.$route.params)||void 0===n?void 0:n.slug});case 3:r=t.sent,o=r.getLockerRoom.isSupported,e.isSupported=o,t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:return t.prev=10,t.next=13,e.setLockerRoomIsLoading(!1);case 13:return t.finish(10);case 14:case"end":return t.stop()}}),t,null,[[0,8,10,14]])})))()},fnLeavePrivateChat:function(data){this.$emit("setPrivateChannel",data)},signUp:function(){this.$router.push("/signup?step=1")},changeStep:function(e){this.$emit("changeStep",e)},cancel:function(){this.$emit("cancel")}})},y=(n(2535),n(10)),component=Object(y.a)(x,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"xp-locker-room-channels row col"},[n("client-only",[!e.getLockerRoomIsLoading&&e.pageLoaded?[n("XTLockerRoomSupported",{attrs:{channelSlug:e.channelSlug,game:e.game,activeChat:e.activeChat,currentStep:e.currentStep,privateChats:e.privateChats,privateChannel:e.privateChannel,lockerRoom:e.lockerRoom||e.lockerRoomProp,onlineMembers:e.onlineMembers,publicMembers:e.publicMembers},on:{cancel:e.cancel,changeStep:e.changeStep,getPrivateChannel:e.fnGetPrivateChannel}}),e.isLoggedIn?e._e():n("div",{staticClass:"unsupported",on:{click:e.signUp}},[n("div",{staticClass:"unsupported-btn"},[e._v("LOG IN")]),n("span",[e._v("Login or sign up to send messages!")])])]:e._e()],2)],1)}),[],!1,null,"79267fee",null);t.default=component.exports}}]);