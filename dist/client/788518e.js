(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{1103:function(e,t,n){"use strict";n(81),n(56),n(82);t.a={data:function(){return{metaTitle:"",metaDescription:"Show the world who you support"}},head:function(){var e;return{title:this.metaTitle||"FX1",link:[{rel:"canonical",href:"".concat(this.baseURL).concat(null===(e=this.$route)||void 0===e?void 0:e.fullPath)}],meta:[{hid:"description",name:"description",content:this.metaDescription.replace(/<\/?[^>]+(>|$)/g,"")},{hid:"twitter:title",name:"twitter:title",content:this.metaTitle},{hid:"twitter:description",name:"twitter:description",content:this.metaDescription.replace(/<\/?[^>]+(>|$)/g,"")},{hid:"twitter:image",name:"twitter:image",content:this.fx1Logo},{hid:"twitter:image:alt",name:"twitter:image:alt",content:this.metaTitle},{hid:"og:title",property:"og:title",content:this.metaTitle},{hid:"og:description",property:"og:description",content:this.metaDescription.replace(/<\/?[^>]+(>|$)/g,"")},{hid:"og:image",property:"og:image",content:this.fx1Logo},{hid:"og:image:secure_url",property:"og:image:secure_url",content:this.fx1Logo},{hid:"og:image:alt",property:"og:image:alt",content:this.metaTitle}]}}}},1283:function(e,t,n){var r=n(1284),o=n(1287)(r);e.exports=o},1284:function(e,t,n){var r=n(1285),o=n(288);e.exports=function(object,e){return object&&r(object,e,o)}},1285:function(e,t,n){var r=n(1286)();e.exports=r},1286:function(e,t){e.exports=function(e){return function(object,t,n){for(var r=-1,o=Object(object),c=n(object),l=c.length;l--;){var h=c[e?l:++r];if(!1===t(o[h],h,o))break}return object}}},1287:function(e,t,n){var r=n(379);e.exports=function(e,t){return function(n,o){if(null==n)return n;if(!r(n))return e(n,o);for(var c=n.length,l=t?c:-1,h=Object(n);(t?l--:++l<c)&&!1!==o(h[l],l,h););return n}}},1295:function(e,t,n){var r=n(1283),o=n(379);e.exports=function(e,t){var n=-1,c=o(e)?Array(e.length):[];return r(e,(function(e,r,o){c[++n]=t(e,r,o)})),c}},1506:function(e,t,n){var r=n(612),o=n(384),c=n(1295),l=n(114);e.exports=function(e,t){return(l(e)?r:c)(e,o(t,3))}},2607:function(e,t,n){"use strict";n.r(t);n(17),n(16),n(19),n(13),n(20);var r=n(5),o=n(93),c=n(29),l=n(0),h=(n(27),n(8),n(28),n(31),n(75),n(14),n(81),n(24),n(229),n(67),n(1072)),d=n(11),m=n(36),map=n(1506),f=n.n(map),v=n(1379),k=n(630),R=n.n(k);function $(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?$(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):$(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var S={name:"PageLockerRoomChannels",components:{XTLockerRoomSupported:function(){return Promise.all([n.e(6),n.e(18),n.e(0),n.e(8),n.e(81)]).then(n.bind(null,2564))},XTLockerRoomUnsupported:function(){return n.e(36).then(n.bind(null,2625))}},mixins:[n(1103).a],layout:"locker-room",asyncData:function(e){return Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,l,h,d,m,f,v,k,R,$,y,S,x,D,w,L,C,O,M,j,I,T,A,E,P;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m=e.app,f=e.route,v=e.store,t.next=3,v.state.notification.active;case 3:if(k=t.sent,R=null==f||null===(n=f.params)||void 0===n?void 0:n.slug,$=null==f||null===(r=f.params)||void 0===r?void 0:r.channel,y={channelSlug:f.params.channel},S={channelSlug:f.params.channel,cursor:(null==k||null===(l=k.createdAt)||void 0===l?void 0:l.toString())||(null==k||null===(h=k.Notification)||void 0===h||null===(d=h.createdAt)||void 0===d?void 0:d.toString()),direction:"up"},!k){t.next=16;break}return t.next=11,m.$api.getMessagesByChannelSlugUsingCreatedAtAsCursor(S);case 11:D=t.sent,w=D.getMessagesByChannelSlugUsingCreatedAtAsCursor.items,x=w,t.next=21;break;case 16:return t.next=18,m.$api.getMessagesByChannelSlug(y);case 18:L=t.sent,C=L.getMessagesByChannelSlug.items,x=C;case 21:return t.next=23,Promise.all([m.$api.getChannel({slug:$}),m.$api.getLockerRoom({slug:R})]);case 23:return O=t.sent,M=Object(c.a)(O,2),j=M[0].getChannel,I=M[1].getLockerRoom,(T=[]).push.apply(T,Object(o.a)(x)),A=v.state.lockerRoom.supporting||[],E=A.filter((function(e){return(null==e?void 0:e.slug)===R})),P=!!E.length,t.abrupt("return",{isSupported:P||(null==I?void 0:I.isSupported),channel:j,lockerRoom:I,chats:T});case 33:case"end":return t.stop()}}),t)})))()},data:function(){return{socket:null,myEmitErrors:{},channel:null,oldChannel:null,isSupported:!0,lockerRoom:null,chats:[],usersTyping:[]}},computed:y(y(y(y(y({},Object(d.b)("locker-room",["lockerRoomActive","lockerRoomReply"])),Object(d.b)("user",["userID","userName","userAvatar"])),Object(d.b)("channels",["channelActive"])),Object(d.b)("app",["showLoader"])),Object(m.c)({getMediaFilesLocal:"media/getMediaFilesLocal",getLockerRoomIsLoading:"lockerRoom/getLockerRoomIsLoading",selectedGif:"giphy/getSelectedGif"})),watch:{selectedGif:function(){this.selectedGif&&this.userID&&(this.fnSendMessage(null,this.lockerRoomReply),this.$store.dispatch("locker-room/setLockerRoomReply",null))},lockerRoomActive:{deep:!0,handler:function(e){this.isSupported=this.isSupported||(null==e?void 0:e.isSupported)}},$route:{deep:!0,immediate:!0,handler:function(){this.$root.$emit("evtRtCancelEdit"),this.clearChatDeleted()}}},created:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,l,h,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("locker-room/setLockerRoomActive",e.lockerRoom);case 2:e.lockerRoomReply=null,o=e.lockerRoomActive||{},c=o.Club,l=o.League,h=o.FanGroup,d=o.Sports,e.metaTitle="".concat(null===(n=e.channel)||void 0===n?void 0:n.name," | ").concat((null==l?void 0:l.name)||(null==c?void 0:c.name)||(null==h?void 0:h.name)," | ").concat(null===(r=d[0])||void 0===r?void 0:r.name," - FX1");case 5:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;this.socket=this.$nuxtSocket({channel:"/",auth:{token:this.$store.state.auth.token||null,type:"desktop"},transports:["websocket"]}),this.$root.$on("evtRtSendMessage",(function(t,n,r,o){e.fnSendMessage(t,n,r,o)})),this.$root.$on("evtRtEditMessage",(function(data){e.fnEditMessage(data)})),this.$root.$on("evtRtDeleteMessage",(function(data){e.fnDeleteMessage(data)})),this.fnConnectToChannel(),this.socket.on("on-message",(function(data){e.chats.push(data.chat)})),this.socket.on("on-edit-message",(function(data){data.chat&&f()(e.chats,(function(e){e.chatID===data.chat.chatID&&(e.text=data.chat.text,e.isEdited=!0)}))})),this.socket.on("on-delete-message",(function(data){var t;if(data.chat){var n=R()(e.chats,{chatID:data.chat.chatID});null!=data&&null!==(t=data.chat)&&void 0!==t&&t.isDeletedEveryone&&(e.chats.splice(n,1),e.fnDeleteReply({chatID:data.chat.chatID,deleteForSelf:!1,deleteForEveryone:!0}))}})),this.socket.on("on-typing-message-v2",(function(data){e.usersTyping=data.filter((function(t){var n=t.username,r=t.channelSlug;return n&&r===e.channelActive.slug})).map((function(e){return e.username}))})),this.socket.on("logs",(function(data){console.log("SERVERLOGS",data)})),this.clearLockerRoomDeletedManagers(),this.$root.$on("evtRtGetChannel",(function(){e.fnGetChannel()})),this.channelActive=this.channel,this.$root.$on("evtRtIsTyping",(function(t){e.fnTypingMessage({userName:t.userName,status:!0})})),this.$root.$on("evtRtDoneTyping",(function(t){e.fnTypingMessage({userName:t.userName,status:!1})})),this.fnRetrieveIsSupported()},beforeDestroy:function(){this.oldChannel&&this.$root.$emit("evtReloadLockerRoom",this.oldChannel),this.$root.$off("evtRtSendMessage")},methods:y(y({},Object(m.b)({clearLockerRoomDeletedManagers:"locker-room/clearLockerRoomDeletedManagers",clearChatDeleted:"chats/clearChatDeleted",setLockerRoomIsLoading:"lockerRoom/setLockerRoomIsLoading",clearSelectedGift:"giphy/clearSelectedGif"})),{},{fnSendMessage:function(e,t,n,r){var o=this;return Object(l.a)(regeneratorRuntime.mark((function c(){var l,d,m,input;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,l={User:{username:o.userName||"FX1 User",Avatar:o.userAvatar,id:o.userID},chatID:Object(h.a)(),text:e,channelSlug:o.$route.params.channel,lockerRoomSlug:o.$route.params.slug,repliedTo:t?{User:{username:null==t?void 0:t.name,id:null==t?void 0:t.userID},text:null==t?void 0:t.text,chatID:null==t?void 0:t.chatID,Media:null==t?void 0:t.Media}:null,Media:null!=n&&n.length?n:null,MentionedUserIDs:r,gif:o.selectedGif},c.next=4,o.socket.emit("send-message",l,(function(){}));case 4:return l.localMedia=o.getMediaFilesLocal||null,l.replyLocalMedia=(null==t?void 0:t.localMedia)||null,Object(v.b)(),o.chats.push(l),d=o.lockerRoomActive,m=o.channelActive,o.$mixpanelClient.trackSendMessage({channel:m,lockerRoom:d,reply:t}),o.$nextTick((function(){o.$root.$emit("evtRtScrollToBottom")})),c.next=14,o.clearSelectedGift();case 14:c.next=18;break;case 16:c.prev=16,c.t0=c.catch(0);case 18:return c.prev=18,null==(input=document.querySelector(".chat-input"))||input.focus(),c.finish(18);case 22:case"end":return c.stop()}}),c,null,[[0,16,18,22]])})))()},fnEditMessage:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var r,text,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.chatID,text=e.text,o=e.repliedToChatID,c=e.Media,n.next=3,t.socket.emit("edit-message",{channelSlug:t.$route.params.channel,chatID:r,text:text,repliedToChatID:o,Media:c},(function(){}));case 3:case"end":return n.stop()}}),n)})))()},fnDeleteMessage:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var r,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.chatID,o=e.deleteForSelf,c=e.deleteForEveryone,n.next=3,t.socket.emit("delete-message",{channelSlug:t.$route.params.channel,chatID:r,isDeletedSelf:o,isDeletedEveryone:c},(function(){t.fnDeleteReply({chatID:r,deleteForSelf:o,deleteForEveryone:c})}));case 3:case"end":return n.stop()}}),n)})))()},fnConnectToChannel:function(){var e=this;this.oldChannel=this.$route.params.channel||null,this.oldChannel&&this.$root.$emit("evtReloadLockerRoom",this.oldChannel),this.socket.emit("join-channel",{channelSlug:this.$route.params.channel},Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,l,h,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=e.lockerRoomActive,r=e.channelActive,o={lockerRoom:n,channel:r,pageName:"Locker room channel",isLoggedIn:e.isLoggedIn},e.$mixpanelClient.trackViewPage(o),t.next=7,e.$api.getNotifications({isRead:!1});case 7:return c=t.sent,l=c.getNotifications.items,h=l.filter((function(t){return t.channelSlug===e.$route.params.channel})),d=h.map((function(e){return e.id})),t.next=13,e.$api.readNotification({notificationIDs:d});case 13:e.$store.dispatch("notification/clearActiveChannelNotification",e.$route.params.channel),e.reloadUnreadChats(),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),e.$toast.error(t.t0.message,{duration:5e3,position:"bottom-left",className:"fx1-error",iconPack:"mdi",icon:"alert-circle-outline"});case 20:case"end":return t.stop()}}),t,null,[[0,17]])}))))},fnGetChannel:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null===(n=e.$route.params)||void 0===n?void 0:n.channel,t.next=3,e.$api.getChannel({slug:r});case 3:o=t.sent,c=o.getChannel,e.channel=c;case 6:case"end":return t.stop()}}),t)})))()},fnRetrievePageDetails:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,l,h,d,m,f,v,k,R,$,y,S;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d=null===(n=e.$route)||void 0===n||null===(r=n.params)||void 0===r?void 0:r.slug,m=null===(l=e.$route)||void 0===l||null===(h=l.params)||void 0===h?void 0:h.channel,f={channelSlug:e.$route.params.channel},t.next=5,Promise.all([e.$api.getMessagesByChannelSlug(f),e.$api.getChannel({slug:m}),e.$api.getLockerRoom({slug:d})]);case 5:v=t.sent,k=Object(c.a)(v,3),R=k[0].getMessagesByChannelSlug.items,$=k[1].getChannel,y=k[2].getLockerRoom,(S=[]).push.apply(S,Object(o.a)(R)),e.isSupported=null==y?void 0:y.isSupported,e.channel=$,e.lockerRoom=y,e.chats=S;case 16:case"end":return t.stop()}}),t)})))()},fnDeleteReply:function(e){var t=e.chatID,n=e.deleteForEveryone,r=e.deleteForSelf;f()(this.chats,(function(data){var e;(null===(e=data.repliedTo)||void 0===e?void 0:e.chatID)===t&&(data.repliedTo=y(y({},{isDeletedEveryone:n,isDeletedSelf:r}),data.repliedTo))}))},fnTypingMessage:function(e){var t=e.userName,n=e.status;this.socket.emit("typing-message-v2",{channelSlug:this.$route.params.channel,userName:t,isTyping:n})},reloadUnreadChats:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$api.getMyProfileSupporting();case 4:if(n=t.sent,r=n.Me.Supporting){t.next=8;break}return t.abrupt("return");case 8:return o=[],t.next=11,null==r?void 0:r.map((function(data){return o.push({slug:data.slug,totalUnreadMessagesCount:data.totalUnreadMessagesCount})}));case 11:return t.next=13,e.$store.dispatch("notification/setLockerRoomCount",o);case 13:case"end":return t.stop()}}),t)})))()},fnRetrieveIsSupported:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.getLockerRoomIsSupported({slug:null===(n=e.$route.params)||void 0===n?void 0:n.slug});case 3:r=t.sent,o=r.getLockerRoom.isSupported,e.isSupported=o,t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:return t.prev=10,e.setLockerRoomIsLoading(!1),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[0,8,10,13]])})))()}})},x=n(10),component=Object(x.a)(S,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"xp-locker-room-channels row col"},[n("client-only",[e.getLockerRoomIsLoading?e._e():[e.isSupported&&e.isLoggedIn?n("XTLockerRoomSupported"):n("XTLockerRoomUnsupported")]],2)],1)}),[],!1,null,null,null);t.default=component.exports}}]);